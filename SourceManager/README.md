# SourceManager

Этот сервис представляет собой связующее звено между пользователем, источниками данных и обработчиком данных. Пользователь отправляет данные на сервис, сервис добавляет данные об источнике в базу данных и по запросу обновляет их.

## Как происходит обработка данных от пользователя?

Все общение происходит по двум запросам, которые отправляются на сервер:

+ **`GET`** - из файла *`SourceManager/internal/http_server/handlers/get/get.go`*
+ **`POST`** - из файла *`SourceManager/internal/http_server/handlers/post/post.go`*

С помощью метода **`GET`** пользователь может запрашивать как один, так и сразу все источники и их содержимое.

С помощью метода **`POST`** пользователь отправляет данные на сервер.

## Как происходит общение с базами данных?

Базы данных для записей результатов общения пользователя и сервиса распологаются в папке *`db`*. В *`SourceManager/internal/db/dbs.go`* содержатся общие структуры баз данных (т.е. структуры для содержания их значений). В *`SourceManager/internal/db/sources/sources.go`* записана реализация интерфейса работы (расположенного в *`SourceManager/internal/repositories`*) с базами данных.

Реализованы методы **`Create`** для создания таблицы и добавления в нее данных, **`ReadOne`** и **`ReadAll`** для чтения одной и всех записей соотвественно.

### Получение информации об источниках на обновление

Также, отдельно для получения необходимых источников на обновление, в директории *`SourceManager/internal/http_client`* были созданы файлы *`handlers/get/get.go`* и *`http_client.go`* для более "прямолинейного" и быстрого доступа к маппингу (откуда и получаем источики).

В *`handlers/get/get.go`*, методом **`GetData`** мы получаем маппинги в строковом формате (для обработки одного источника), а методом **`GetMultipleData`** получаем строку, содержащую маппинги всех необходимых источников, используемых конкретной моделью.

В *`http_client.go`*, методом **`UpdateData`** получаем список ID всех индексов, с которых запрашиваем обновленную информацию.

## Как происходит общение с другими сервисами?

С другими сервисами, а точнее с другим сервисом - *DataProcessor*, - происходит общение по gRPC запросам. Этот сервис (*SourceManager*) удаленно вызывает у серсива *DataProcessor* процедуру обрабротки данных, которые передает *SourceManager*. Передача данных проходит потоком, чтобы в случае чтения последательной передачи данных или передачи очень больших объемов данных, вся система не "замирала" в ожидании, а постепенно обрабатывала уже считанную информацию.

Установка соединения происходит в *`SourceManager/cmd/main.go`*, а обработка запроса - в *`SourceManager/internal/grpc/grpc_client.go`*.

## Дополнительные файлы
### Конфигурационный файл

В *`SourceManager/config`* хранятся конфигурационные файлы, используемые при запуске программы для ее настройки. В *`SourceManager/internal/config/config.go`* происходит парсинг файла настроек.

### Прото файлы

Файлы для описания gRPC запроса, заранее сгенерированные *Protobuf*, хранятся в директории *`SourceManager/internal/proto`*.

### Логгеры
Настраиваемый в засимости от конфигурационного файла логгер хранится в *`SourceManager/internal/logger/logger.go`*. Используется как основной.

Также, middleware для подробной записи логов работы обработчика (хэндлера) хранится в *`SourceManager/internal/http_server/middleware/logger.go`*.
