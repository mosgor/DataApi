# DataProcessor

Этот сервис отвеает за приведение данных в удобный формат для моделей данных. Сервис получает шаблон, на основе которого меняет формат данных. Пользователь отправляет шаблон, с которым уже работает сервис.

## Как происходит получение данных?

Для получения данных используется протокол передачи данных gRPC. В файле `main.py` запускается сервер для получения данных с `DataProcessorServicer`.

`DataProcessorServicer` описан в файле `data_processor.py`. С `SourceManager` происходит вызов функции `ProcessData`, в аргументах которой находятся следующие данные:

+ `"source_id"` - id источника. На основе id происходит выборка маппинга.
+ `"data_json"` - исходные данные с источника.
+ `"arrival_time"` - для статистики

На основе `"data_json"` создаётся JSON-документ, который затем и будет радактироваться.

## Как происходит получение маппинга?

Для получения маппинга используется докер. Подключение к докеру происходит в файле `docker.py`.

Из докера происходит выделение коллекции `'mappings'`, а затем её фильтрация по `"source_id"`. В результате получается необходимый список маппинов `"documents"`

## Что из себя представляет маппинг?

Маппинг представляет собой JSON-документ, содержащий информацию о необходимой структуре данных. Внутри маппинг состоит из следующих списков:

`{source_path:"путь_к_полю_данных_в_исходниках",  model_name:"новый_путь_к_этому_полю"}`